<script>
var map = L.map('map').setView([51.62, 24.30], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let tracker1Marker = null;
let tracker2Marker = null;
let tracker3Marker = null;

async function fetchAndUpdateTracker(url, marker, label) {
    try {
        const response = await fetch(url, { cache: "no-store" });
        if (!response.ok) throw new Error(`Błąd HTTP: ${response.status}`);
        const data = await response.json();

        const lat = data.latitude;
        const lon = data.longitude;

        if (!lat || !lon) throw new Error("Brak danych GPS");

        if (marker.value) {
            marker.value.setLatLng([lat, lon]);
        } else {
            marker.value = L.marker([lat, lon]).addTo(map)
                .bindPopup(`<b>${label}</b><br>Latitude: ${lat}<br>Longitude: ${lon}`)
                .openPopup();
        }

        console.log(`✅ ${label} zaktualizowany:`, lat, lon);
    } catch (err) {
        console.error(`❌ Błąd przy ${label}:`, err);
    }
}

function updateAllTrackers() {
    fetchAndUpdateTracker("https://raw.githubusercontent.com/Barix1122/TrackerGPS/main/data.json", { value: tracker1Marker }, "Tracker 1");
    fetchAndUpdateTracker("https://raw.githubusercontent.com/Barix1122/TrackerGPS/main/data2.json", { value: tracker2Marker }, "Tracker 2");
    fetchAndUpdateTracker("https://raw.githubusercontent.com/Barix1122/TrackerGPS/main/data3.json", { value: tracker3Marker }, "Tracker 3");
}

setInterval(updateAllTrackers, 10000);
updateAllTrackers();
</script>
